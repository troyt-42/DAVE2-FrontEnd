!function(){"use strict";function e(e,t,o,r,a,n,l){function i(){l.emit("requestImporterList"),angular.element(".importerContainerRightPanel").addClass("fadeIn"),N.importerList=[],N.promiseToSolve=e(function(){for(var e=!1,t=0;t<N.alerts.stepOne.length;t++)"Loading Importer List Failed. Please Check Your Internet Connection."===N.alerts.stepOne[t].msg&&(e=!0);e||N.alerts.stepOne.push({type:"danger",msg:"Loading Importer List Failed. Please Check Your Internet Connection."}),N.systemStatus="Error"},5e3)}function s(e,t){0!==N.avaliableTableColumns.length&&(N.importerListTableColumns[e.index-1].status=!0,N.avaliableTableColumns.splice(t,1))}function m(e,t,o){if(console.log(t),13===e.keyCode)if(t.index===t.newIndex)N.addTableColumn(t,o);else{t.newIndex>N.importerListTableColumns.length&&(t.newIndex=N.importerListTableColumns.length),t.newIndex<1&&(t.newIndex=1),N.importerListTableColumns[t.index-1].index=t.newIndex-1,N.importerListTableColumns[t.newIndex-1].index=t.index-1;var r=N.importerListTableColumns[t.index-1];N.importerListTableColumns[t.index-1]=N.importerListTableColumns[t.newIndex-1],N.importerListTableColumns[t.newIndex-1]=r,t.index=t.newIndex,console.log(t),console.log(N.avaliableTableColumns),console.log(N.importerListTableColumns),N.addTableColumn(t,o)}}function p(){N.stepOne=!0,N.stepTwo=!1,N.stepTwoB=!1,N.stepThree=!1,N.currentDataItem="",N.importerToDisplay={},N.importerToDisplayContent=[],N.importerDataItemToDisplay={},N.importerDataItemData=[],N.activate()}function c(){N.formModel={}}function u(){N.stepOne=!0,N.stepTwo=!1,N.stepTwoB=!1,N.stepThree=!1,N.fileUploadProgress=0,N.waitingMessage="File Uploading"}function d(e){var t=r.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}function f(e){N.currentDataItem=e,N.importerDataItemData=N.importerDataItemToDisplay[N.currentDataItem.fieldName]}function g(e,t){angular.element("div.alert.animated#"+t+e).removeClass("fadeInDown"),angular.element("div.alert.animated#"+t+e).addClass("fadeOutUp"),N.alerts[t].splice(e,1)}function I(e){return e.fieldName===N.currentDataItem.fieldName?"active":""}function T(){var e=[];console.log(N.stepThreeFormCollection);for(var t in N.stepThreeFormCollection){var o={availableOptions:{}};for(var r in N.stepThreeFormCollection[t])switch(r){case"fields":break;case"checked":o.checked=N.stepThreeFormCollection[t][r];break;default:o.availableOptions[r]={name:r,value:N.stepThreeFormCollection[t][r]}}o.fieldName=t,e.push(o)}console.log(e),l.emit("decideImporterCreation",{location:N.importerCreationMeta.location,importerName:N.importerCreationMeta.importerName,userName:N.importerCreationMeta.userName,files:N.importerCreationMeta.files,data:e,description:N.importerCreationMeta.description}),N.stepOne=!1,N.stepTwo=!0,N.stepTwoB=!1,N.stepThree=!1,console.log(e)}function h(e){for(var t=e-1;t>=0;t--)if(N.importerListTableColumns[t].status){var o=N.importerListTableColumns[e];o.index=t,N.importerListTableColumns[t].index=e,N.importerListTableColumns[e]=N.importerListTableColumns[t],N.importerListTableColumns[t]=o;break}}function C(e){for(var t=e+1;t<N.importerListTableColumns.length;t++)if(N.importerListTableColumns[t].status){var o=N.importerListTableColumns[e];o.index=t,N.importerListTableColumns[t].index=e,N.importerListTableColumns[e]=N.importerListTableColumns[t],N.importerListTableColumns[t]=o;break}}function D(e){N.importerListTableColumns[e].status=!1,N.avaliableTableColumns.push({index:e+1,value:N.importerListTableColumns[e].name,newIndex:e+1})}function y(e){var t=N.formModel.Browse.indexOf(e);-1!==t&&(N.formModel.Browse.splice(t,1),console.log(N.formModel))}function v(t){console.log(t),N.importerToDisplay=t,l.emit("requestImporter",t),"Normal"===N.systemStatus&&null===N.requestImporterPromiseToSolve&&(N.requestImporterPromiseToSolve=e(function(){-1===N.alerts.stepOne.indexOf({type:"danger",msg:"Timeout"})&&N.alerts.stepOne.push({type:"danger",msg:"Timeout"}),N.systemStatus="Error"},1500))}function w(){N.stepOne=!1,N.stepTwo=!0,N.stepTwoB=!1,N.stepThree=!1;var e=N.formModel.Browse;if(console.log(e),e!=={}){for(var t={importerName:N.formModel.Name,files:[],location:N.formModel.Location,description:N.formModel.Description,userName:"troy"},o=0;o<N.formModel.Browse.length;o++)t.files.push({fileName:N.formModel.Browse[o].name});a.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:N.formModel.Name,location:N.formModel.Location,description:N.formModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log(t),N.fileUploadProgress=t,t>=100&&(N.waitingMessage="Waiting response from server",console.log(N.waitingMessage))}).success(function(e,o,r,a){l.emit("createNewImporter",t),console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Browse")}function L(){angular.element(".js-layout").toggleClass("hidden")}function b(){angular.element(".importerContainerLeftMenu").toggleClass("noExpanded"),angular.element(".importerContainerRightPanel").toggleClass("expanded"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-left  animated flipInY"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-right  animated flipInY")," Expand"===angular.element("#js-expand-sign").html()?angular.element("#js-expand-sign").html(" Collapse"):" Collapse"===angular.element("#js-expand-sign").html()&&angular.element("#js-expand-sign").html(" Expand")}function x(){N.stepOneSearchMode=N.stepOneSearchMode?!1:!0,angular.element("#js-pagination").toggleClass("rotateInUpLeft"),angular.element("#js-pagination").toggleClass("rotateOutDownLeft"),console.log(angular.element("#js-search-sign").html())," Search Mode"===angular.element("#js-search-sign").html()?angular.element("#js-search-sign").html(" Importer List"):" Importer List"===angular.element("#js-search-sign").html()&&angular.element("#js-search-sign").html(" Search Mode")}function M(){var e=r.open({templateUrl:"Importer/ImporterModalViews/updateImporter.html",controller:"UpdateImporterModalCtrl as updateImporterModalCtrl",resolve:{currentImporter:function(){return N.importerToDisplay}}});e.result.then(function(e){console.log(e)})}var N=this;N.activate=i,N.addTableColumn=s,N.addTableColumnKeyPress=m,N.backToImporterList=p,N.cancelFile=c,N.cancelImport=u,N.changeDataItemConfig=d,N.chooseDataItem=f,N.closeAlert=g,N.dataItemListClass=I,N.decideImport=T,N.decreaseColumnIndex=h,N.increaseColumnIndex=C,N.requestImporter=v,N.removeFile=y,N.removeColumn=D,N.submitFile=w,N.toggleLayOutMenu=L,N.toggleLeftMenu=b,N.toggleSearchMode=x,N.updateImporter=M,N.alerts={stepOne:[],stepTwoB:[]},N.avaliableTableColumns=[],N.currentDataItem="Fermenter Sample HPLC Ethanol",N.formModel={},N.fileUploadProgress=0,N.importerList=[],N.importerListCurrentPage=1,N.stepOneSearchMode=!1,N.stepOneSearchModeInput={},N.importerToDisplay={},N.importerToDisplayContent=[],N.importerDataItemToDisplay={},N.importerDataItemData=[],N.importerListTableColumns=[{name:"importerName",status:!0,index:0},{name:"location",status:!0,index:1},{name:"ownerName",status:!0,index:2},{name:"type",status:!0,index:3},{name:"description",status:!0,index:4}],N.promiseToSolve=null,N.requestImporterPromiseToSolve=null,N.stepOne=!0,N.stepTwo=!1,N.stepTwoB=!1,N.stepThree=!1,N.stepOneLoading=!0,N.stepThreeFormCollection=[],N.sampleDataQuantity=50,N.sampleDataReduction=50,N.search={},N.search2={fieldName:""},N.systemStatus="Normal",N.optionStatus={firstOpen:!0,secondOpen:!1,thirdOpen:!1,fourthOpen:!1},N.formFields=[{type:"input",key:"Name"},{type:"input",key:"Location"},{type:"textarea",key:"Description"},{type:"input3",key:"Browse",data:{inputType:"file"},ngModelAttrs:{fileAccept:{attribute:"accept"},fileUploaderMarkup:{attribute:"ngf-select"},fileUploaderMultipleMarkup:{attribute:"ngf-multiple"}},templateOptions:{fileAccept:".csv",fileUploaderMarkup:"",fileUploaderMultipleMarkup:!0},expressionProperties:{"templateOptions.disabled":"!(model.Name || model.Location || model.Description)"}}],N.waitingMessage="File Uploading",o.$watch(function(){return N.stepOne},function(e){e===!0?o.$emit("dynamicBackground"):e===!1&&o.$emit("removeDynamicBackground")}),l.on("importerListData",function(t){"Normal"===N.systemStatus&&(e.cancel(N.promiseToSolve),console.log("called"),0!==t.length?(N.importerList=N.importerList.concat(t),N.stepOneLoading=!1,angular.element(".js-layout").addClass("hidden")):console.log(N.importerList))}),l.on("importerData",function(t){if("Normal"===N.systemStatus)if(e.cancel(N.requestImporterPromiseToSolve),0!==t.length)N.currentDataItem=t[0],console.log(t[0]),N.stepOne=!1,N.stepTwo=!1,N.stepTwoB=!0,N.stepThree=!1,N.importerToDisplayContent=t;else if(0===t.length&&(console.log(N.importerToDisplayContent),N.importerToDisplayContent.forEach(function(e,t,o){l.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:N.importerToDisplay.location})}),0===N.importerToDisplayContent.length)){for(var o=!1,r=0;r<N.alerts.stepOne.length;r++)"Received Empty Importer"===N.alerts.stepOne[r].msg&&(o=!0);o||N.alerts.stepOne.push({type:"warning",msg:"Received Empty Importer"})}}),l.on("importerDataItemData",function(e){"Normal"===N.systemStatus&&(0!==e.data.length?(N.importerDataItemToDisplay[e.name]||(N.importerDataItemToDisplay[e.name]=[]),N.importerDataItemToDisplay[e.name]=N.importerDataItemToDisplay[e.name].concat(e.data)):0===e.data.length&&N.importerDataItemToDisplay[N.currentDataItem.fieldName].length&&0===N.importerDataItemData.length&&(N.importerDataItemData=N.importerDataItemToDisplay[N.currentDataItem.fieldName],console.log(N.importerDataItemData)))});var O=[];l.on("importerCreationResponse",function(e){"Normal"===N.systemStatus&&(N.fileUploadProgress=0,0!==e.data.length?O=O.concat(e.data):(console.log(N.stepThreeFormCollection),N.stepThreeFormCollection=n(O),N.importerCreationMeta={importerName:e.importerName,location:e.location,userName:e.userName,files:e.files,description:e.description},O=[],N.stepOne=!1,N.stepTwo=!1,N.stepTwoB=!1,N.stepThree=!0))}),l.on("importerCreationFinalResponse",function(e){if("Normal"===N.systemStatus){if(console.log(e),"SUCCESS"===e.reply)if(N.fileUploadProgress=100*e.payload.status,0!==e.list_out)N.importerToDisplay={importerName:e.importerName,location:e.location,ownerName:e.ownerName},N.currentDataItem=e.list_out[0],N.stepOne=!1,N.stepTwo=!1,N.stepTwoB=!0,N.stepThree=!1,N.importerToDisplayContent=e.list_out,N.importerToDisplayContent.forEach(function(e,t,o){l.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:N.importerToDisplay.location})});else if(0===N.importerToDisplayContent.length){for(var t=!1,o=0;o<N.alerts.stepThree.length;o++)"Created Empty Importer"===N.alerts.stepThree[o].msg&&(t=!0);t||N.alerts.stepThree.push({type:"warning",msg:"Created Empty Importer"})}"PROGRESSING"===e.reply&&(N.fileUploadProgress=100*e.payload.status)}}),N.activate()}function t(e,t,o,r,a){function n(){s.uploading=!0,r.upload({url:"/Importer/uploadFile",file:s.files,fields:{uploadInfo:{name:s.currentImporter.importerName,location:s.currentImporter.location,description:s.currentImporter.description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);s.fileUploadProgress=t,t>=100&&(s.waitingMessage="Waiting response from server")}).success(function(e,t,o,r){for(var n={importerName:s.currentImporter.importerName,location:s.currentImporter.location,files:[]},l=0;l<s.files.length;l++)n.files.push({fileName:s.files[l].name});a.emit("updateImporter",n),console.log("uploadSuccess")}).error(function(e){alert(e)})}function l(){t.dismiss("cancel")}function i(e){var t=s.files.indexOf(e);-1!==t&&s.files.splice(t,1)}var s=this;s.update=n,s.cancel=l,s.removeFile=i,s.currentImporter=o,s.files=null,s.fileUploadProgress=0,s.waitingMessage="",s.uploading=!1}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e).controller("UpdateImporterModalCtrl",t),e.$inject=["$timeout","$http","$scope","$modal","Upload","FormSettingParseService","ImporterSocket"],t.$inject=["$scope","$modalInstance","currentImporter","Upload","ImporterSocket"]}();