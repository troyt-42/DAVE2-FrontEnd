!function(){"use strict";function e(e,t,o,r,a,n,i){function s(){i.emit("requestImporterList"),angular.element(".importerContainerLeftMenu").addClass("fadeInLeft"),angular.element(".importerContainerRightPanel").addClass("fadeIn"),h.promiseToSolve=e(function(){for(var e=!1,t=0;t<h.alerts.stepOne.length;t++)"Loading Importer List Failed. Please Check Your Internet Connection."===h.alerts.stepOne[t].msg&&(e=!0);e||h.alerts.stepOne.push({type:"danger",msg:"Loading Importer List Failed. Please Check Your Internet Connection."}),h.systemStatus="Error"},5e3)}function l(){h.stepOne=!0,h.stepTwo=!1,h.stepTwoB=!1,h.stepThree=!1}function m(){h.formModel={}}function p(){h.stepOne=!0,h.stepTwo=!1,h.stepTwoB=!1,h.stepThree=!1,h.fileUploadProgress=0,h.waitingMessage="File Uploading"}function c(e){var t=r.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}function u(e){h.currentDataItem=e,h.importerDataItemData=h.importerDataItemToDisplay[h.currentDataItem.fieldName]}function d(e,t){angular.element("div.alert.animated#"+t+e).removeClass("fadeInDown"),angular.element("div.alert.animated#"+t+e).addClass("fadeOutUp"),h.alerts[t].splice(e,1)}function f(){var e=[];console.log(h.stepThreeFormCollection);for(var t in h.stepThreeFormCollection){var o={availableOptions:{}};for(var r in h.stepThreeFormCollection[t])switch(r){case"fields":break;case"checked":o.checked=h.stepThreeFormCollection[t][r];break;default:o.availableOptions[r]={name:r,value:h.stepThreeFormCollection[t][r]}}o.fieldName=t,e.push(o)}console.log(e),i.emit("decideImporterCreation",{location:h.importerCreationMeta.location,importerName:h.importerCreationMeta.importerName,userName:h.importerCreationMeta.userName,files:h.importerCreationMeta.files,data:e,description:h.importerCreationMeta.description}),h.stepOne=!1,h.stepTwo=!0,h.stepTwoB=!1,h.stepThree=!1}function g(e){var t=h.formModel.Browse.indexOf(e);-1!==t&&(h.formModel.Browse.splice(t,1),console.log(h.formModel)),0===h.formModel.Browse.length&&angular.element("#formly_1_input_Browse_3").val("")}function D(t){console.log(t),h.importerToDisplay=t,i.emit("requestImporter",t),"Normal"===h.systemStatus&&null===h.requestImporterPromiseToSolve&&(h.requestImporterPromiseToSolve=e(function(){-1===h.alerts.stepOne.indexOf({type:"danger",msg:"Timeout"})&&h.alerts.stepOne.push({type:"danger",msg:"Timeout"}),h.systemStatus="Error"},1500))}function T(){h.stepOne=!1,h.stepTwo=!0,h.stepTwoB=!1,h.stepThree=!1;var e=h.formModel.Browse;if(console.log(e),e!=={}){for(var t={importerName:h.formModel.Name,files:[],location:h.formModel.Location,description:h.formModel.Description,userName:"troy"},o=0;o<h.formModel.Browse.length;o++)t.files.push({fileName:h.formModel.Browse[o].name});a.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:h.formModel.Name,filename:h.formModel.Browse[0].name,location:h.formModel.Location,description:h.formModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log(t),h.fileUploadProgress=t,t>=100&&(h.waitingMessage="Waiting response from server",console.log(h.waitingMessage))}).success(function(e,o,r,a){i.emit("createNewImporter",t),console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Browse")}var h=this;h.backToImporterList=l,h.cancelFile=m,h.cancelImport=p,h.changeDataItemConfig=c,h.chooseDataItem=u,h.closeAlert=d,h.decideImport=f,h.requestImporter=D,h.removeFile=g,h.submitFile=T,h.alerts={stepOne:[],stepTwoB:[]},h.availableFields={},h.currentDataItem="Fermenter Sample HPLC Ethanol",h.formModel={},h.fileUploadProgress=0,h.importerList=[],h.importerListCurrentPage=1,h.importerToDisplay={},h.importerToDisplayContent=[],h.importerDataItemToDisplay={},h.importerDataItemData=[],h.promiseToSolve=null,h.requestImporterPromiseToSolve=null,h.stepOne=!0,h.stepTwo=!1,h.stepTwoB=!1,h.stepThree=!1,h.stepOneLoading=!0,h.stepThreeFormCollection=[],h.sampleDataQuantity=50,h.sampleDataReduction=50,h.search={},h.search2={fieldName:""},h.systemStatus="Normal",h.optionStatus={firstOpen:!0,secondOpen:!1,thirdOpen:!1,fourthOpen:!1},h.formFields=[{type:"input",key:"Name"},{type:"input",key:"Location"},{type:"textarea",key:"Description"},{type:"input",key:"Browse",data:{inputType:"file"},ngModelAttrs:{fileAccept:{attribute:"accept"},fileUploaderMarkup:{attribute:"ngf-select"},fileUploaderMultipleMarkup:{attribute:"ngf-multiple"}},templateOptions:{fileAccept:".csv",fileUploaderMarkup:"",fileUploaderMultipleMarkup:!0},expressionProperties:{"templateOptions.disabled":"!(model.Name || model.Location || model.Description)"}}],h.waitingMessage="File Uploading",o.$watch(function(){return h.stepOne},function(e){e===!0?o.$emit("dynamicBackground"):e===!1&&o.$emit("removeDynamicBackground")}),o.$watch(function(){return h.sampleDataReduction},function(e){10>=e?h.sampleDataReductionString="1 Hour":e>10&&20>=e?h.sampleDataReductionString="2 Hour":e>20&&30>=e?h.sampleDataReductionString="3 Hour":e>30&&40>=e?h.sampleDataReductionString="4 Hour":e>40&&50>=e?h.sampleDataReductionString="5 Hour":e>50&&60>=e?h.sampleDataReductionString="6 Hour":e>60&&70>=e?h.sampleDataReductionString="7 Hour":e>70&&80>=e?h.sampleDataReductionString="8 Hour":e>80&&90>=e?h.sampleDataReductionString="9 Hour":e>90&&100>=e&&(h.sampleDataReductionString="10 Hour")}),i.on("importerListData",function(t){"Normal"===h.systemStatus&&(e.cancel(h.promiseToSolve),0!==t.length?(h.importerList=h.importerList.concat(t),h.stepOneLoading=!1):console.log(h.importerList))}),i.on("importerData",function(t){if("Normal"===h.systemStatus)if(e.cancel(h.requestImporterPromiseToSolve),0!==t.length)h.currentDataItem=t[0],console.log(t[0]),h.stepOne=!1,h.stepTwo=!1,h.stepTwoB=!0,h.stepThree=!1,h.importerToDisplayContent=t;else if(0===t.length&&(console.log(h.importerToDisplayContent),h.importerToDisplayContent.forEach(function(e,t,o){i.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:h.importerToDisplay.location})}),0===h.importerToDisplayContent.length)){for(var o=!1,r=0;r<h.alerts.stepOne.length;r++)"Received Empty Importer"===h.alerts.stepOne[r].msg&&(o=!0);o||h.alerts.stepOne.push({type:"warning",msg:"Received Empty Importer"})}}),i.on("importerDataItemData",function(e){"Normal"===h.systemStatus&&(0!==e.data.length?(h.importerDataItemToDisplay[e.name]||(h.importerDataItemToDisplay[e.name]=[]),h.importerDataItemToDisplay[e.name]=h.importerDataItemToDisplay[e.name].concat(e.data)):0===e.data.length&&h.importerDataItemToDisplay[h.currentDataItem.fieldName].length&&0===h.importerDataItemData.length&&(h.importerDataItemData=h.importerDataItemToDisplay[h.currentDataItem.fieldName],console.log(h.importerDataItemData)))});var I=[];i.on("importerCreationResponse",function(e){"Normal"===h.systemStatus&&(0!==e.data.length?I=I.concat(e.data):(console.log(h.stepThreeFormCollection),h.stepThreeFormCollection=n(I),h.importerCreationMeta={importerName:e.importerName,location:e.location,userName:e.userName,files:e.files,description:e.description},I=[],h.stepOne=!1,h.stepTwo=!1,h.stepTwoB=!1,h.stepThree=!0))}),i.on("importerCreationFinalResponse",function(e){if("Normal"===h.systemStatus&&"SUCCESS"===e.reply)if(0!==e.list_out)h.importerToDisplay={importerName:e.importerName,location:e.location,ownerName:e.ownerName},h.currentDataItem=e.list_out[0],h.stepOne=!1,h.stepTwo=!1,h.stepTwoB=!0,h.stepThree=!1,h.importerToDisplayContent=e.list_out,h.importerToDisplayContent.forEach(function(e,t,o){i.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:h.importerToDisplay.location})});else if(0===h.importerToDisplayContent.length){for(var t=!1,o=0;o<h.alerts.stepThree.length;o++)"Created Empty Importer"===h.alerts.stepThree[o].msg&&(t=!0);t||h.alerts.stepThree.push({type:"warning",msg:"Created Empty Importer"})}}),s()}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e),e.$inject=["$timeout","$http","$scope","$modal","Upload","FormSettingParseService","ImporterSocket"]}();