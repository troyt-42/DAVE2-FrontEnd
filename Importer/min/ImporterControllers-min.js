!function(){"use strict";function e(e,o,a,r,n,i,l){function p(){l.emit("requestImporterList")}function s(){T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1}function m(){T.formModel={}}function c(){T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1,T.fileUploadProgress=0}function u(){var e=[];console.log(T.stepThreeFormCollection);for(var t in T.stepThreeFormCollection){var a={availableOptions:{}};for(var r in T.stepThreeFormCollection[t])switch(r){case"fields":break;case"checked":a.checked=T.stepThreeFormCollection[t][r];break;default:a.availableOptions[r]={name:r,value:T.stepThreeFormCollection[t][r]}}a.fieldName=t,e.push(a)}console.log(e),l.emit("decideImporterCreation",{location:T.importerCreationMeta.location,data:e}),o.post("/Importer/decideImport",e).success(function(e,t,o,a){T.stepOne=!1,T.stepTwo=!1,T.stepTwoB=!0,T.stepThree=!1,T.fileUploadProgress=0}).error(function(e,t,o,a){alert("Something Wents Wrong")})}function d(e){console.log(e),T.importerToDisplay=e,l.emit("requestImporter",e)}function f(e){T.currentDataItem=e,T.importerDataItemData=T.importerDataItemToDisplay[T.currentDataItem.fieldName]}function D(e,t){T.alerts[t].splice(e,1)}function g(e){var t=r.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}var T=this;T.submitFile=t,T.cancelFile=m,T.cancelImport=c,T.decideImport=u,T.requestImporter=d,T.chooseDataItem=f,T.backToImporterList=s,T.closeAlert=D,T.changeDataItemConfig=g,T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1,T.stepOneLoading=!0,T.formModel={},T.fileUploadProgress=0,T.availableFields={},T.importerList=[],T.importerListCurrentPage=1,T.importerToDisplay={},T.importerToDisplayContent=[],T.importerDataItemToDisplay={},T.importerDataItemData=[],T.currentDataItem="Fermenter Sample HPLC Ethanol",T.stepThreeFormCollection=[],T.alerts={stepOne:[{type:"danger",msg:"Load Item Fails. Please Check Your Internet Connect."}],stepTwoB:[{type:"warning",msg:"Lost Connection (still can manipulate cached data)"}]},T.sampleDataQuantity=50,T.sampleDataReduction=50,T.search={},T.search2="",T.optionStatus={firstOpen:!0,secondOpen:!1,thirdOpen:!1,fourthOpen:!1},T.formFields=[{type:"input",key:"Name"},{type:"input",key:"Location"},{type:"textarea",key:"Description"},{type:"input",key:"Select A File",data:{inputType:"file"},ngModelAttrs:{fileAccept:{attribute:"accept"},fileUploaderMarkup:{attribute:"ngf-select"},fileUploaderOnChangeMarkup:{attribute:"ngf-change"},fileUploaderModelMarkup:{attribute:"ng-model"}},templateOptions:{fileAccept:".csv",fileUploaderMarkup:"",fileUploaderOnChangeMarkup:"fileSelected($files, $event)",fileUploaderModelMarkup:"uploadfile"},expressionProperties:{"templateOptions.disabled":"!(model.Name || model.Location || model.Description)"}}],a.$watch(function(){return T.stepOne},function(e){e===!0?a.$emit("dynamicBackground"):e===!1&&a.$emit("removeDynamicBackground")}),a.$on("stepTwo",function(){T.stepOne=!1,T.stepTwo=!0,T.stepTwoB=!1,T.stepThree=!1}),a.$on("uploadProgress",function(t,o){console.log(o),T.fileUploadProgress=o,o>=100&&e(function(){T.stepOne=!1,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!0},1e3)}),a.$watch(function(){return T.sampleDataReduction},function(e){10>=e?T.sampleDataReductionString="1 Hour":e>10&&20>=e?T.sampleDataReductionString="2 Hour":e>20&&30>=e?T.sampleDataReductionString="3 Hour":e>30&&40>=e?T.sampleDataReductionString="4 Hour":e>40&&50>=e?T.sampleDataReductionString="5 Hour":e>50&&60>=e?T.sampleDataReductionString="6 Hour":e>60&&70>=e?T.sampleDataReductionString="7 Hour":e>70&&80>=e?T.sampleDataReductionString="8 Hour":e>80&&90>=e?T.sampleDataReductionString="9 Hour":e>90&&100>=e&&(T.sampleDataReductionString="10 Hour")}),l.on("importerListData",function(e){0!==e.length?(T.importerList=T.importerList.concat(e),T.stepOneLoading=!1):console.log(T.importerList)}),l.on("importerData",function(e){0!==e.length?(T.currentDataItem=e[0],T.stepOne=!1,T.stepTwo=!1,T.stepTwoB=!0,T.stepThree=!1,T.importerToDisplayContent=e):0===e.length&&T.importerToDisplayContent.forEach(function(e,t,o){l.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:T.importerToDisplay.location})})}),l.on("importerDataItemData",function(e){0!==e.data.length?(T.importerDataItemToDisplay[e.name]||(T.importerDataItemToDisplay[e.name]=[]),T.importerDataItemToDisplay[e.name]=T.importerDataItemToDisplay[e.name].concat(e.data)):0===e.data.length&&(T.importerDataItemData=T.importerDataItemToDisplay[T.currentDataItem.fieldName],console.log(T.importerDataItemData))});var h=[];l.on("importerCreationResponse",function(e){0!==e.data.length?h=h.concat(e.data):(console.log(T.stepThreeFormCollection),T.stepThreeFormCollection=i(h),T.importerCreationMeta={importerName:e.importerName,location:e.location},h=[])}),p()}function t(){console.log(vm.formModel);var e=vm.formModel["Select A File"][0];if(console.log(e),e!=={}){var t={importerName:vm.formModel.Name,fileName:vm.formModel["Select A File"][0].name,location:vm.formModel.Location,description:vm.formModel.Description,userName:"troy"};ImporterSocket.emit("createNewImporter",t),Upload.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:vm.formModel.Name,filename:vm.formModel["Select A File"][0].name,location:vm.formModel.Location,description:vm.formModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);$scope.$emit("uploadProgress",t)}).success(function(e,t,o,a){console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Select A File");$scope.$emit("stepTwo")}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e),e.$inject=["$timeout","$http","$scope","$modal","Upload","FormSettingParseService","ImporterSocket"]}();