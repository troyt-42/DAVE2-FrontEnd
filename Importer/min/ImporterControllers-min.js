!function(){"use strict";function e(e,t,o,r,a,n,i,l){function s(){f.formModel={}}function m(){f.stepOne=!0,f.stepTwo=!1,f.stepTwoB=!1,f.stepThree=!1,f.fileUploadProgress=0,f.waitingMessage="File Uploading"}function p(e){var t=r.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}function c(){var e=[];console.log(f.stepThreeFormCollection);for(var t in f.stepThreeFormCollection){var o={availableOptions:{}};for(var r in f.stepThreeFormCollection[t])switch(r){case"fields":break;case"checked":o.checked=f.stepThreeFormCollection[t][r];break;default:o.availableOptions[r]={name:r,value:f.stepThreeFormCollection[t][r]}}o.fieldName=t,e.push(o)}console.log(e),i.emit("decideImporterCreation",{location:f.importerCreationMeta.location,importerName:f.importerCreationMeta.importerName,userName:f.importerCreationMeta.userName,files:f.importerCreationMeta.files,data:e,description:f.importerCreationMeta.description}),f.stepOne=!1,f.stepTwo=!0,f.stepTwoB=!1,f.stepThree=!1,console.log(e)}function u(e){var t=f.formModel.Browse.indexOf(e);-1!==t&&(f.formModel.Browse.splice(t,1),console.log(f.formModel))}function d(){var e=f.formModel.Browse;if(console.log(e),e!=={}){for(var t={importerName:f.formModel.Name,files:[],location:f.formModel.Location,description:f.formModel.Description,userName:"troy"},o=0;o<f.formModel.Browse.length;o++)t.files.push({fileName:f.formModel.Browse[o].name});a.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:f.formModel.Name,location:f.formModel.Location,description:f.formModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log(t),f.fileUploadProgress=t,t>=100&&(f.waitingMessage="Waiting response from server",console.log(f.waitingMessage))}).success(function(e,o,r,a){i.emit("createNewImporter",t),console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Browse")}function g(){f.stepOneSearchMode=f.stepOneSearchMode?!1:!0,angular.element("#js-pagination").toggleClass("rotateInUpLeft"),angular.element("#js-pagination").toggleClass("rotateOutDownLeft"),console.log(angular.element("#js-search-sign").html())," Search Mode"===angular.element("#js-search-sign").html()?angular.element("#js-search-sign").html(" Importer List"):" Importer List"===angular.element("#js-search-sign").html()&&angular.element("#js-search-sign").html(" Search Mode")}var f=this;f.cancelFile=s,f.cancelImport=m,f.changeDataItemConfig=p,f.decideImport=c,f.removeFile=u,f.submitFile=d,f.toggleSearchMode=g,f.alerts={stepOne:[],stepTwoB:[]},f.formModel={},f.fileUploadProgress=0,f.stepOneSearchMode=!1,f.stepOneSearchModeInput={},f.importerToDisplayContent=[],f.promiseToSolve=null,f.requestImporterPromiseToSolve=null,f.stepOne=!0,f.stepTwo=!1,f.stepTwoB=!1,f.stepThree=!1,f.stepOneLoading=!0,f.stepThreeFormCollection=[],f.sampleDataQuantity=50,f.sampleDataReduction=50,f.search2={fieldName:""},f.systemStatus="Normal",f.optionStatus={firstOpen:!0,secondOpen:!1,thirdOpen:!1,fourthOpen:!1},f.formFields=[{type:"input",key:"Name"},{type:"input",key:"Location"},{type:"textarea",key:"Description"},{type:"input3",key:"Browse",data:{inputType:"file"},ngModelAttrs:{fileAccept:{attribute:"accept"},fileUploaderMarkup:{attribute:"ngf-select"},fileUploaderMultipleMarkup:{attribute:"ngf-multiple"}},templateOptions:{fileAccept:".csv",fileUploaderMarkup:"",fileUploaderMultipleMarkup:!0},expressionProperties:{"templateOptions.disabled":"!(model.Name || model.Location || model.Description)"}}],f.waitingMessage="File Uploading",o.$watch(function(){return f.stepOne},function(e){e===!0?o.$emit("dynamicBackground"):e===!1&&o.$emit("removeDynamicBackground")});var I=[];i.on("importerCreationResponse",function(e){"Normal"===f.systemStatus&&(f.fileUploadProgress=0,0!==e.data.length?I=I.concat(e.data):(console.log(f.stepThreeFormCollection),f.stepThreeFormCollection=n(I),f.importerCreationMeta={importerName:e.importerName,location:e.location,userName:e.userName,files:e.files,description:e.description},I=[],f.stepOne=!1,f.stepTwo=!1,f.stepTwoB=!1,f.stepThree=!0))}),i.on("importerCreationFinalResponse",function(e){if("Normal"===f.systemStatus){if(console.log(e),"SUCCESS"===e.reply)if(f.fileUploadProgress=100*e.payload.status,0!==e.list_out)f.importerToDisplay={importerName:e.importerName,location:e.location,ownerName:e.ownerName},f.currentDataItem=e.list_out[0],f.stepOne=!1,f.stepTwo=!1,f.stepTwoB=!0,f.stepThree=!1,f.importerToDisplayContent=e.list_out,f.importerToDisplayContent.forEach(function(e,t,o){i.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:f.importerToDisplay.location})});else if(0===f.importerToDisplayContent.length){for(var t=!1,o=0;o<f.alerts.stepThree.length;o++)"Created Empty Importer"===f.alerts.stepThree[o].msg&&(t=!0);t||f.alerts.stepThree.push({type:"warning",msg:"Created Empty Importer"})}"PROGRESSING"===e.reply&&(f.fileUploadProgress=100*e.payload.status)}})}function t(e,t,o,r,a){function n(){s.uploading=!0,r.upload({url:"/Importer/uploadFile",file:s.files,fields:{uploadInfo:{name:s.currentImporter.importerName,location:s.currentImporter.location,description:s.currentImporter.description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);s.fileUploadProgress=t,t>=100&&(s.waitingMessage="Waiting response from server")}).success(function(e,t,o,r){for(var n={importerName:s.currentImporter.importerName,location:s.currentImporter.location,files:[]},i=0;i<s.files.length;i++)n.files.push({fileName:s.files[i].name});a.emit("updateImporter",n),console.log("uploadSuccess")}).error(function(e){alert(e)})}function i(){t.dismiss("cancel")}function l(e){var t=s.files.indexOf(e);-1!==t&&s.files.splice(t,1)}var s=this;s.update=n,s.cancel=i,s.removeFile=l,s.currentImporter=o,s.files=null,s.fileUploadProgress=0,s.waitingMessage="",s.uploading=!1}function o(e,t,o,r,a,n,i){function l(){t.emit("requestImporterList"),T.promiseToSolve=r(function(){for(var e=!1,t=0;t<T.alerts.length;t++)"Loading Importer List Failed. Please Check Your Internet Connection."===T.alerts[t].msg&&(e=!0);e||T.alerts.push({type:"danger",msg:"Loading Importer List Failed. Please Check Your Internet Connection."}),T.systemStatus="Error"},5e3)}function s(e,t){0!==T.avaliableTableColumns.length&&(T.importerListTableColumns[e.index-1].status=!0,T.avaliableTableColumns.splice(t,1))}function m(e,t,o){if(console.log(t),13===e.keyCode)if(t.index===t.newIndex)T.addTableColumn(t,o);else{t.newIndex>T.importerListTableColumns.length&&(t.newIndex=T.importerListTableColumns.length),t.newIndex<1&&(t.newIndex=1),T.importerListTableColumns[t.index-1].index=t.newIndex-1,T.importerListTableColumns[t.newIndex-1].index=t.index-1;var r=T.importerListTableColumns[t.index-1];T.importerListTableColumns[t.index-1]=T.importerListTableColumns[t.newIndex-1],T.importerListTableColumns[t.newIndex-1]=r,t.index=t.newIndex,console.log(t),console.log(T.avaliableTableColumns),console.log(T.importerListTableColumns),T.addTableColumn(t,o)}}function p(e){angular.element("div.alert.animated#importerList"+e).removeClass("fadeInDown"),angular.element("div.alert.animated#importerList"+e).addClass("fadeOutUp"),T.alerts.splice(e,1)}function c(e){for(var t=e-1;t>=0;t--)if(T.importerListTableColumns[t].status){var o=T.importerListTableColumns[e];o.index=t,T.importerListTableColumns[t].index=e,T.importerListTableColumns[e]=T.importerListTableColumns[t],T.importerListTableColumns[t]=o;break}}function u(e){for(var t=e+1;t<T.importerListTableColumns.length;t++)if(T.importerListTableColumns[t].status){var o=T.importerListTableColumns[e];o.index=t,T.importerListTableColumns[t].index=e,T.importerListTableColumns[e]=T.importerListTableColumns[t],T.importerListTableColumns[t]=o;break}}function d(e){T.importerListTableColumns[e].status=!1,T.avaliableTableColumns.push({index:e+1,value:T.importerListTableColumns[e].name,newIndex:e+1})}function g(e){T.importerToRequest=e;var t=o.$parent.$new(!0);t.importerToRequest={},angular.copy(T.importerToRequest,t.importerToRequest),i.DestroyDirectiveService("dave-importer-list-page",o),i.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-page importer-to-request="{{importerToRequest}}"></dave-importer-page>',t,a)}function f(){angular.element(".js-layout").toggleClass("hidden")}function I(){angular.element(".importerContainerLeftMenu").toggleClass("noExpanded"),angular.element(".importerContainerRightPanel").toggleClass("expanded"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-left  animated flipInY"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-right  animated flipInY")," Expand"===angular.element("#js-expand-sign").html()?angular.element("#js-expand-sign").html(" Collapse"):" Collapse"===angular.element("#js-expand-sign").html()&&angular.element("#js-expand-sign").html(" Expand")}var T=this;T.activate=l,T.addTableColumn=s,T.addTableColumnKeyPress=m,T.closeAlert=p,T.decreaseColumnIndex=c,T.increaseColumnIndex=u,T.removeColumn=d,T.requestImporter=g,T.toggleLayOutMenu=f,T.toggleLeftMenu=I,T.alerts=[],T.avaliableTableColumns=[],T.importerListCurrentPage=1,T.importerList=[],T.importerListTableColumns=[{name:"importerName",status:!0,index:0},{name:"location",status:!0,index:1},{name:"ownerName",status:!0,index:2},{name:"type",status:!0,index:3},{name:"description",status:!0,index:4}],T.importerToRequest="",T.loading=!0,T.promiseToSolve="",T.search={},T.systemStatus="Normal",t.on("importerListData",function(e){"Normal"===T.systemStatus&&(r.cancel(T.promiseToSolve),0!==e.length?(T.importerList=T.importerList.concat(e),T.loading=!1):console.log(T.importerList))}),T.activate()}function r(e,t,o,r,a,n){function i(){e.emit("requestImporter",p.importerToDisplay),"Normal"===p.systemStatus&&null===p.requestImporterPromiseToSolve&&(p.requestImporterPromiseToSolve=o(function(){-1===p.alerts.indexOf({type:"danger",msg:"Timeout"})&&p.alerts.push({type:"danger",msg:"Timeout"}),p.systemStatus="Error"},1500))}function l(){var e=t.$parent.$new(!0);n.DestroyDirectiveService("dave-importer-page",t),n.AddDirectiveService(".importerContainerRightPanel","<dave-importer-list-page></dave-importer-list-page>",e,r)}function s(e){p.currentDataItem=e,p.importerDataItemData=p.importerDataItemToDisplay[p.currentDataItem.fieldName]}function m(){var e=a.open({templateUrl:"Importer/ImporterModalViews/updateImporter.html",controller:"UpdateImporterModalCtrl as updateImporterModalCtrl",resolve:{currentImporter:function(){return p.importerToDisplay}}});e.result.then(function(e){console.log(e)})}var p=this;p.activate=i,p.backToImporterList=l,p.chooseDataItem=s,p.updateImporter=m,p.alerts=[],p.currentDataItem="",p.importerDataItemToDisplay={},p.importerDataItemData=[],p.importerToDisplay=JSON.parse(t.importerToRequest),p.importerToDisplayContent=[],p.requestImporterPromiseToSolve=null,p.search={fieldName:""},p.systemStatus="Normal",e.on("importerData",function(t){if("Normal"===p.systemStatus)if(o.cancel(p.requestImporterPromiseToSolve),0!==t.length)p.currentDataItem=t[0],console.log(t[0]),p.importerToDisplayContent=t;else if(0===t.length&&(console.log(p.importerToDisplayContent),p.importerToDisplayContent.forEach(function(t,o,r){e.emit("requestImporterDataItemData",{fieldName:t.fieldName,location:p.importerToDisplay.location})}),0===p.importerToDisplayContent.length)){for(var r=!1,a=0;a<p.alerts.stepOne.length;a++)"Received Empty Importer"===p.alerts.stepOne[a].msg&&(r=!0);r||p.alerts.stepOne.push({type:"warning",msg:"Received Empty Importer"})}}),e.on("importerDataItemData",function(e){"Normal"===p.systemStatus&&(0!==e.data.length?(p.importerDataItemToDisplay[e.name]||(p.importerDataItemToDisplay[e.name]=[]),p.importerDataItemToDisplay[e.name]=p.importerDataItemToDisplay[e.name].concat(e.data)):0===e.data.length&&p.importerDataItemToDisplay[p.currentDataItem.fieldName].length&&0===p.importerDataItemData.length&&(p.importerDataItemData=p.importerDataItemToDisplay[p.currentDataItem.fieldName],console.log(p.importerDataItemData)))}),p.activate()}function a(e,t,o){}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e).controller("UpdateImporterModalCtrl",t).controller("DaveImporterListPageCtrl",o).controller("DaveImporterPageCtrl",r).controller("DaveImporterConfigurationPageCtrl",a),e.$inject=["$timeout","$http","$scope","$modal","Upload","FormSettingParseService","ImporterSocket","DirectiveService"],t.$inject=["$scope","$modalInstance","currentImporter","Upload","ImporterSocket"],o.$inject=["FormSettingParseService","ImporterSocket","$scope","$timeout","$compile","$rootScope","DirectiveService"],r.$inject=["ImporterSocket","$scope","$timeout","$compile","$modal","DirectiveService"],a.$index=["$scope","ImporterSocket","DirectiveService"]}();