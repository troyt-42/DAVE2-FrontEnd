!function(){"use strict";function e(e,t,o,r,a,i,n,l,m,s,p){function c(){C.formModel={}}function u(){}function d(){console.log(C.randomImporterFormModel),s.emit("createRandomImporter",C.randomImporterFormModel)}function g(e){var t=r.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}function f(e){var t=C.fileToUpload.indexOf(e);-1!==t&&(C.fileToUpload.splice(t,1),console.log(C.formModel))}function v(){var e=C.fileToUpload;if(console.log(e),e!=={}){for(var t={importerName:C.createNewImporterFormModel.Name,files:[],location:C.createNewImporterFormModel.Location,description:C.createNewImporterFormModel.Description,userName:"troy"},o=0;o<C.fileToUpload.length;o++)t.files.push({fileName:C.fileToUpload[o].name});p.DestroyDirectiveService(".angular-directive",angular.element(".angular-directive").isolateScope()),C.progressing=!0,l.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:C.createNewImporterFormModel.Name,location:C.createNewImporterFormModel.Location,description:C.createNewImporterFormModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log(t),C.fileUploadProgress=t,t>=100&&(C.progressingStat[0]=1,C.waitingMessage="Waiting response from server",console.log(C.waitingMessage))}).success(function(e,o,r,a){s.emit("createNewImporter",t),console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Select a File")}var C=this;C.cancelFile=c,C.cancelRandomImporter=u,C.createRandomImporter=d,C.changeDataItemConfig=g,C.removeFile=f,C.submitFile=v,C.alerts={stepOne:[],stepTwoB:[]},C.createNewImporterFormModel={},C.leftMenuExpanded=!1,C.fileToUpload=[],C.fileUploadProgress=0,C.randomImporterFormFields=[{type:"input",key:"Maximum Value",data:{inputType:"number",placeholder:0}},{type:"input",key:"Minimum Value",data:{inputType:"number",placeholder:0}},{type:"input",key:"Maximum Slope",data:{inputType:"number",placeholder:0}},{type:"input",key:"Minimum Slope",data:{inputType:"number",placeholder:0}},{type:"input",key:"Reduction (/mm)",data:{inputType:"number",placeholder:0}},{type:"input",key:"Target Importer Name",data:{placeholder:"example"}},{type:"input",key:"Location",data:{placeholder:"example"}}],C.randomImporterFormModel={"Maximum Value":0,"Minimum Value":0,"Maximum Slope":0,"Minimum Slope":0,"Reduction (/mm)":1e3,"Target Data Item Name":"test",Location:"brampton"},C.progressing=!1,C.progressingStat=[0,1],C.stepOneSearchMode=!1,C.stepOneSearchModeInput={},C.importerCreationPromise="",C.importerToDisplayContent=[],C.promiseToSolve=null,C.requestImporterPromiseToSolve=null,C.stepOne=!0,C.stepTwo=!1,C.stepTwoB=!1,C.stepThree=!1,C.stepOneLoading=!0,C.stepThreeFormCollection=[],C.sampleDataQuantity=50,C.sampleDataReduction=50,C.search2={fieldName:""},C.systemStatus="Normal",C.optionStatus={firstOpen:!1,secondOpen:!0,thirdOpen:!1,fourthOpen:!1},C.createNewImporterFormFields=[{type:"input",key:"Name",data:{placeholder:"example"}},{type:"input",key:"Location",data:{placeholder:"example"}},{type:"textarea",key:"Description"}],C.waitingMessage="File Uploading",o.$on("progressing",function(e,t){C.progressing=!0,C.progressingStat=t,C.importerCreationPromise=i(function(){C.fileUploadProgress+=4},1e3,25),console.log("progressing"),console.log(t)}),o.$on("toggleLeftMenu",function(){angular.element(".importerContainerLeftMenu").toggleClass("noExpanded"),angular.element(".importerContainerRightPanel").toggleClass("expanded"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-left  animated flipInY"),angular.element("#js-expand-arrow").toggleClass("glyphicon-arrow-right  animated flipInY")," Expand"===angular.element("#js-expand-sign").html()?angular.element("#js-expand-sign").html(" Collapse"):" Collapse"===angular.element("#js-expand-sign").html()&&angular.element("#js-expand-sign").html(" Expand")}),o.$watch(function(){return C.stepOne},function(e){e===!0?o.$emit("dynamicBackground"):e===!1&&o.$emit("removeDynamicBackground")});var I=[];s.on("importerCreationResponse",function(e){if("Normal"===C.systemStatus&&(I=I.concat(e.data),1===e.completeState)){if(console.log(C.stepThreeFormCollection),C.stepThreeFormCollection=m(I),C.importerCreationMeta={importerName:e.importerName,location:e.location,userName:e.userName,files:e.files,description:e.description},I=[],C.progressing=!1,console.log(angular.element("dave-importer-configuration-page")),!angular.element("dave-importer-configuration-page").length){var t=o.$new(!0);t.formCollection=C.stepThreeFormCollection,t.importerCreationMeta=C.importerCreationMeta,p.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-configuration-page  class="angular-directive" form-collection="{{formCollection}}" importer-creation-meta="{{importerCreationMeta}}"></dave-importer-configuration-page>',t,a)}C.fileUploadProgress=0}}),s.on("importerCreationFinalResponse",function(t){if("Normal"===C.systemStatus){if(console.log(t),"COMPLETE"===t.reply){C.importerToRequest={importerName:t.payload.importerName,location:t.payload.location,ownerName:t.payload.ownerName,description:t.payload.description};var r=o.$new(!0);r.importerToRequest={},angular.copy(C.importerToRequest,r.importerToRequest),e(function(){p.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-page class="angular-directive" importer-to-request="{{importerToRequest}}"></dave-importer-page>',r,a),C.progressing=!1},1500)}"PROGRESSING"===t.reply&&(C.progressingStat[1]=t.payload.numFiles,C.fileUploadProgress=100*t.payload.status,1===t.payload.status&&(C.progressingStat[0]=t.payload.numFinishProcessedFile)),"submitting"===t.reply&&1===t.completeState&&(i.cancel(C.importerCreationPromise),C.fileUploadProgress=100)}})}function t(e,t,o,r,a){function i(){m.uploading=!0,r.upload({url:"/Importer/uploadFile",file:m.files,fields:{uploadInfo:{name:m.currentImporter.importerName,location:m.currentImporter.location,description:m.currentImporter.description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);m.fileUploadProgress=t,t>=100&&(m.waitingMessage="Waiting response from server")}).success(function(e,t,o,r){for(var i={importerName:m.currentImporter.importerName,location:m.currentImporter.location,files:[]},n=0;n<m.files.length;n++)i.files.push({fileName:m.files[n].name});a.emit("updateImporter",i),console.log("uploadSuccess")}).error(function(e){alert(e)})}function n(){t.dismiss("cancel")}function l(e){var t=m.files.indexOf(e);-1!==t&&m.files.splice(t,1)}var m=this;m.update=i,m.cancel=n,m.removeFile=l,m.currentImporter=o,m.files=null,m.fileUploadProgress=0,m.waitingMessage="",m.uploading=!1}function o(e,t,o,r,a,i,n,l){function m(){void 0===n.getObject("importerListTableColumns")&&n.putObject("importerListTableColumns",T.importerListTableColumns),T.importerListTableColumns=n.getObject("importerListTableColumns"),T.avaliableTableColumns=n.getObject("avaliableTableColumns")||[],t.emit("requestImporterList"),l.CheckDirectiveExpandStatus(".importerContainerRightPanel"),T.promiseToSolve=r(function(){for(var e=!1,t=0;t<T.alerts.length;t++)"Loading Importer List Failed. Please Check Your Internet Connection."===T.alerts[t].msg&&(e=!0);e||T.alerts.push({type:"danger",msg:"Loading Importer List Failed. Please Check Your Internet Connection."}),T.systemStatus="Error"},5e3)}function s(e,t){0!==T.avaliableTableColumns.length&&(T.importerListTableColumns[e.index-1].status=!0,T.avaliableTableColumns.splice(t,1),n.putObject("importerListTableColumns",T.importerListTableColumns),n.putObject("avaliableTableColumns",T.avaliableTableColumns))}function p(e,t,o){if(console.log(t),13===e.keyCode)if(t.index===t.newIndex)T.addTableColumn(t,o);else{t.newIndex>T.importerListTableColumns.length&&(t.newIndex=T.importerListTableColumns.length),t.newIndex<1&&(t.newIndex=1),T.importerListTableColumns[t.index-1].index=t.newIndex-1,T.importerListTableColumns[t.newIndex-1].index=t.index-1;var r=T.importerListTableColumns[t.index-1];T.importerListTableColumns[t.index-1]=T.importerListTableColumns[t.newIndex-1],T.importerListTableColumns[t.newIndex-1]=r,t.index=t.newIndex,console.log(t),console.log(T.avaliableTableColumns),console.log(T.importerListTableColumns),T.addTableColumn(t,o)}n.putObject("importerListTableColumns",T.importerListTableColumns),n.putObject("avaliableTableColumns",T.avaliableTableColumns)}function c(e){angular.element("div.alert.animated#importerList"+e).removeClass("fadeInDown"),angular.element("div.alert.animated#importerList"+e).addClass("fadeOutUp"),T.alerts.splice(e,1)}function u(e){for(var t=e-1;t>=0;t--)if(T.importerListTableColumns[t].status){var o=T.importerListTableColumns[e];o.index=t,T.importerListTableColumns[t].index=e,T.importerListTableColumns[e]=T.importerListTableColumns[t],T.importerListTableColumns[t]=o;break}}function d(e){for(var t=e+1;t<T.importerListTableColumns.length;t++)if(T.importerListTableColumns[t].status){var o=T.importerListTableColumns[e];o.index=t,T.importerListTableColumns[t].index=e,T.importerListTableColumns[e]=T.importerListTableColumns[t],T.importerListTableColumns[t]=o;break}}function g(e){T.importerListTableColumns[e].status=!1,T.avaliableTableColumns.push({index:e+1,value:T.importerListTableColumns[e].name,newIndex:e+1}),console.log(T.avaliableTableColumns),n.putObject("importerListTableColumns",T.importerListTableColumns),n.putObject("avaliableTableColumns",T.avaliableTableColumns)}function f(e){T.importerToRequest=e;var t=o.$parent.$new(!0);t.importerToRequest={},angular.copy(T.importerToRequest,t.importerToRequest),l.DestroyDirectiveService("dave-importer-list-page",o),l.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-page class="angular-directive" importer-to-request="{{importerToRequest}}"></dave-importer-page>',t,a)}function v(){angular.element(".js-layout").toggleClass("hidden")}function C(){o.$emit("toggleLeftMenu")}function I(){l.EnterSearchMode("dave-importer-list-page","<dave-importer-list-page></dave-importer-list-page>",".importerContainerRightPanel",o,a)}var T=this;T.activate=m,T.addTableColumn=s,T.addTableColumnKeyPress=p,T.closeAlert=c,T.decreaseColumnIndex=u,T.increaseColumnIndex=d,T.removeColumn=g,T.requestImporter=f,T.toggleLayOutMenu=v,T.toggleLeftMenu=C,T.toggleSearchMode=I,T.alerts=[],T.avaliableTableColumns=[],T.importerListCurrentPage=1,T.importerList=[],T.importerListTableColumns=[{name:"importerName",status:!0,index:0},{name:"location",status:!0,index:1},{name:"ownerName",status:!0,index:2},{name:"type",status:!0,index:3},{name:"description",status:!0,index:4}],T.importerToRequest="",T.loading=!0,T.promiseToSolve="",T.search={},T.systemStatus="Normal",t.on("importerListData",function(e){"Normal"===T.systemStatus&&(r.cancel(T.promiseToSolve),1!==e.completeState?T.importerList=T.importerList.concat(e.list_out):(T.importerList=T.importerList.concat(e.list_out),T.loading=!1))}),o.$watch(function(){return T.search},function(){console.log(T.search)},!0),o.$on("$destroy",function(e){t.removeListener("importerListData")}),T.activate()}function r(e,t,o,r,a,i,n,l){function m(){console.log(n.getObject("requestedImporter")),void 0===n.getObject("requestedImporter")&&(n.putObject("requestedImporter",v.importerToDisplay),console.log(v.importerToDisplay)),v.importerToDisplay=n.getObject("requestedImporter"),n.remove("requestedImporter"),e.emit("requestImporter",v.importerToDisplay),l.CheckDirectiveExpandStatus(".importerContainerRightPanel"),v.loading=!0}function s(){var e=t.$parent.$new(!0);l.DestroyDirectiveService("dave-importer-page",t),l.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-list-page  class="angular-directive"></dave-importer-list-page>',e,r)}function p(e){v.currentDataItem=e,v.importerDataItemData=v.importerDataItemToDisplay[v.currentDataItem.fieldName]}function c(e){angular.element("div.alert.animated#importer"+e).removeClass("fadeInDown"),angular.element("div.alert.animated#importer"+e).addClass("fadeOutUp"),v.alerts.splice(e,1)}function u(){t.$emit("toggleLeftMenu")}function d(){var e=a.open({templateUrl:"Importer/ImporterModalViews/updateImporter.html",controller:"UpdateImporterModalCtrl as updateImporterModalCtrl",resolve:{currentImporter:function(){return v.importerToDisplay}}});e.result.then(function(e){console.log(e)})}function g(){console.log(i.url()),i.url("/DataItemDisplay"),l.DestroyDirectiveService("dave-importer-page",t)}function f(){n.putObject("requestedImporter",v.importerToDisplay),l.EnterSearchMode("dave-importer-page","<dave-importer-page></dave-importer-page>",".importerContainerRightPanel",t,r)}var v=this;v.activate=m,v.backToImporterList=s,v.chooseDataItem=p,v.closeAlert=c,v.updateImporter=d,v.viewMoreData=g,v.alerts=[],v.currentDataItem="",t.expanded=!1,v.importerDataItemToDisplay={},v.importerDataItemData=[],v.importerToDisplay=t.importerToRequest?JSON.parse(t.importerToRequest):{},v.importerToDisplayContent=[],v.loading=!1,v.requestDataItemPromiseToSolve=null,v.search={fieldName:""},v.systemStatus="Normal",v.toggleLeftMenu=u,v.toggleSearchMode=f,e.on("importerData",function(t){if("Normal"===v.systemStatus&&(""===v.currentDataItem&&(v.currentDataItem=t.list_out[0]),v.importerToDisplayContent=v.importerToDisplayContent.concat(t.list_out),1===t.completeState&&(v.loading=!0,v.importerToDisplayContent.forEach(function(t,o,r){e.emit("requestImporterDataItemData",{fieldName:t.fieldName,location:v.importerToDisplay.location})}),null===v.requestDataItemPromiseToSolve&&(v.requestDataItemPromiseToSolve=o(function(){-1===v.alerts.indexOf({type:"danger",msg:"Data Item Timeout"})&&v.alerts.push({type:"danger",msg:"Data Item Timeout"}),v.systemStatus="Error"},3e3)),0===v.importerToDisplayContent.length))){for(var r=!1,a=0;a<v.alerts.length;a++)"Received Empty Importer"===v.alerts[a].msg&&(r=!0);r||v.alerts.push({type:"warning",msg:"Received Empty Importer"})}}),e.on("importerDataItemData",function(e){"Normal"===v.systemStatus&&(o.cancel(v.requestDataItemPromiseToSolve),v.loading=!1,v.importerDataItemToDisplay[e.name]||(v.importerDataItemToDisplay[e.name]=[]),v.importerDataItemToDisplay[e.name]=v.importerDataItemToDisplay[e.name].concat(e.data),1===e.completeState&&e.name===v.currentDataItem.fieldName&&(console.log(v.importerDataItemToDisplay[v.currentDataItem.fieldName].length),0===v.importerDataItemToDisplay[v.currentDataItem.fieldName].length?(v.loading=!0,-1===v.alerts.indexOf({type:"warning",msg:"Received Empty Data Item"})&&(console.log("called"),v.alerts.push({type:"warning",msg:"Received Empty Data Item"})),v.systemStatus="Error"):v.importerDataItemData=v.importerDataItemToDisplay[v.currentDataItem.fieldName]))}),t.$on("$destroy",function(t){e.removeListener("importerData"),e.removeListener("importerDataItemData")}),v.activate()}function a(e,t,o,r){function a(){var o=e.$parent.$new(!0);r.DestroyDirectiveService("dave-importer-configuration-page",angular.element("dave-importer-configuration-page").isolateScope()),r.AddDirectiveService(".importerContainerRightPanel",'<dave-importer-list-page  class="angular-directive"></dave-importer-list-page>',o,t)}function i(){var t=[];for(var a in n.formCollection){var i={availableOptions:{}};for(var l in n.formCollection[a])switch(l){case"fields":break;case"checked":i.checked=n.formCollection[a][l];break;default:i.availableOptions[l]={name:l,value:n.formCollection[a][l]}}i.fieldName=a,t.push(i)}console.log(t),o.emit("decideImporterCreation",{location:n.importerCreationMeta.location,importerName:n.importerCreationMeta.importerName,userName:n.importerCreationMeta.userName,files:n.importerCreationMeta.files,data:t,description:n.importerCreationMeta.description});var m=[0,1];e.$emit("progressing",m),r.DestroyDirectiveService("dave-importer-configuration-page",angular.element("dave-importer-configuration-page").isolateScope())}var n=this;n.cancelImport=a,n.decideImport=i,console.log(e.formCollection),n.formCollection=JSON.parse(e.formCollection),n.importerCreationMeta=JSON.parse(e.importerCreationMeta)}function i(e,t,o,r,a,i){function n(){a.CheckDirectiveExpandStatus(".importerContainerRightPanel"),s.searchableColumns=o.getObject("importerListTableColumns")}function l(){var o=e.$parent.$new(!0);a.DestroyDirectiveService("dave-importer-search-mode-page",e),a.AddDirectiveService(".importerContainerRightPanel",s.backDirective,o,t)}function m(){e.$emit("toggleLeftMenu")}var s=this;s.activate=n,s.back=l,s.toggleLeftMenu=m,s.backDirective=e.backDirective,s.activate()}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e).controller("UpdateImporterModalCtrl",t).controller("DaveImporterListPageCtrl",o).controller("DaveImporterPageCtrl",r).controller("DaveImporterConfigurationPageCtrl",a).controller("DaveImporterSearchModePageCtrl",i),e.$inject=["$timeout","$http","$scope","$modal","$compile","$interval","$cookies","Upload","FormSettingParseService","ImporterSocket","DirectiveService"],t.$inject=["$scope","$modalInstance","currentImporter","Upload","ImporterSocket"],o.$inject=["FormSettingParseService","ImporterSocket","$scope","$timeout","$compile","$rootScope","$cookies","DirectiveService"],r.$inject=["ImporterSocket","$scope","$timeout","$compile","$modal","$location","$cookies","DirectiveService"],a.$inject=["$scope","$compile","ImporterSocket","DirectiveService"],i.$inject=["$scope","$compile","$cookies","ImporterSocket","DirectiveService"]}();