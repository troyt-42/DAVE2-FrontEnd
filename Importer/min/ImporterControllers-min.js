!function(){"use strict";function e(e,t,o,a,r,n,i){function l(){i.emit("requestImporterList"),angular.element(".importerContainerLeftMenu").addClass("fadeInLeft"),angular.element(".importerContainerRightPanel").addClass("fadeIn"),T.promiseToSolve=e(function(){for(var e=!1,t=0;t<T.alerts.stepOne.length;t++)"Loading Importer List Failed. Please Check Your Internet Connection."===T.alerts.stepOne[t].msg&&(e=!0);e||T.alerts.stepOne.push({type:"danger",msg:"Loading Importer List Failed. Please Check Your Internet Connection."}),T.systemStatus="Error"},5e3)}function s(){T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1}function p(){T.formModel={}}function m(){T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1,T.fileUploadProgress=0,T.waitingMessage="File Uploading"}function c(e){var t=a.open({templateUrl:"Importer/changeDataItemModal.html",controller:["$scope","$modalInstance",function(t,o){t.dataItem=e,t.type="text",t.ok=function(){o.close({name:t.dataItem.name,value:t.dataItem.value})},t.cancel=function(){o.dismiss("cancel")}}]});t.result.then(function(e){console.log(e)})}function u(e){T.currentDataItem=e,T.importerDataItemData=T.importerDataItemToDisplay[T.currentDataItem.fieldName]}function d(e,t){angular.element("div.alert.animated#"+t+e).removeClass("fadeInDown"),angular.element("div.alert.animated#"+t+e).addClass("fadeOutUp"),T.alerts[t].splice(e,1)}function f(){var e=[];console.log(T.stepThreeFormCollection);for(var t in T.stepThreeFormCollection){var o={availableOptions:{}};for(var a in T.stepThreeFormCollection[t])switch(a){case"fields":break;case"checked":o.checked=T.stepThreeFormCollection[t][a];break;default:o.availableOptions[a]={name:a,value:T.stepThreeFormCollection[t][a]}}o.fieldName=t,e.push(o)}console.log(e),i.emit("decideImporterCreation",{location:T.importerCreationMeta.location,importerName:T.importerCreationMeta.importerName,userName:T.importerCreationMeta.userName,files:T.importerCreationMeta.files,data:e}),T.stepOne=!1,T.stepTwo=!0,T.stepTwoB=!1,T.stepThree=!1}function g(t){console.log(t),T.importerToDisplay=t,i.emit("requestImporter",t),"Normal"===T.systemStatus&&null===T.requestImporterPromiseToSolve&&(T.requestImporterPromiseToSolve=e(function(){-1===T.alerts.stepOne.indexOf({type:"danger",msg:"Timeout"})&&T.alerts.stepOne.push({type:"danger",msg:"Timeout"}),T.systemStatus="Error"},1500))}function D(){T.stepOne=!1,T.stepTwo=!0,T.stepTwoB=!1,T.stepThree=!1,console.log(T.formModel);var e=T.formModel["Select A File"][0];if(console.log(e),e!=={}){var t={importerName:T.formModel.Name,fileName:T.formModel["Select A File"][0].name,location:T.formModel.Location,description:T.formModel.Description,userName:"troy"};r.upload({url:"/Importer/uploadFile",file:e,fields:{uploadInfo:{name:T.formModel.Name,filename:T.formModel["Select A File"][0].name,location:T.formModel.Location,description:T.formModel.Description}}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log(t),T.fileUploadProgress=t,t>=100&&(T.waitingMessage="Waiting response from server",console.log(T.waitingMessage))}).success(function(e,o,a,r){i.emit("createNewImporter",t),console.log("uploadSuccess")}).error(function(e){alert(e)})}else alert("Please Select A File")}var T=this;T.backToImporterList=s,T.cancelFile=p,T.cancelImport=m,T.changeDataItemConfig=c,T.chooseDataItem=u,T.closeAlert=d,T.decideImport=f,T.requestImporter=g,T.submitFile=D,T.alerts={stepOne:[],stepTwoB:[]},T.availableFields={},T.currentDataItem="Fermenter Sample HPLC Ethanol",T.formModel={},T.fileUploadProgress=0,T.importerList=[],T.importerListCurrentPage=1,T.importerToDisplay={},T.importerToDisplayContent=[],T.importerDataItemToDisplay={},T.importerDataItemData=[],T.promiseToSolve=null,T.requestImporterPromiseToSolve=null,T.stepOne=!0,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!1,T.stepOneLoading=!0,T.stepThreeFormCollection=[],T.sampleDataQuantity=50,T.sampleDataReduction=50,T.search={},T.search2="",T.systemStatus="Normal",T.optionStatus={firstOpen:!0,secondOpen:!1,thirdOpen:!1,fourthOpen:!1},T.formFields=[{type:"input",key:"Name"},{type:"input",key:"Location"},{type:"textarea",key:"Description"},{type:"input",key:"Select A File",data:{inputType:"file"},ngModelAttrs:{fileAccept:{attribute:"accept"},fileUploaderMarkup:{attribute:"ngf-select"},fileUploaderOnChangeMarkup:{attribute:"ngf-change"},fileUploaderModelMarkup:{attribute:"ng-model"}},templateOptions:{fileAccept:".csv",fileUploaderMarkup:"",fileUploaderOnChangeMarkup:"fileSelected($files, $event)",fileUploaderModelMarkup:"uploadfile"},expressionProperties:{"templateOptions.disabled":"!(model.Name || model.Location || model.Description)"}}],T.waitingMessage="File Uploading",o.$watch(function(){return T.stepOne},function(e){e===!0?o.$emit("dynamicBackground"):e===!1&&o.$emit("removeDynamicBackground")}),o.$watch(function(){return T.sampleDataReduction},function(e){10>=e?T.sampleDataReductionString="1 Hour":e>10&&20>=e?T.sampleDataReductionString="2 Hour":e>20&&30>=e?T.sampleDataReductionString="3 Hour":e>30&&40>=e?T.sampleDataReductionString="4 Hour":e>40&&50>=e?T.sampleDataReductionString="5 Hour":e>50&&60>=e?T.sampleDataReductionString="6 Hour":e>60&&70>=e?T.sampleDataReductionString="7 Hour":e>70&&80>=e?T.sampleDataReductionString="8 Hour":e>80&&90>=e?T.sampleDataReductionString="9 Hour":e>90&&100>=e&&(T.sampleDataReductionString="10 Hour")}),i.on("importerListData",function(t){"Normal"===T.systemStatus&&(e.cancel(T.promiseToSolve),0!==t.length?(T.importerList=T.importerList.concat(t),T.stepOneLoading=!1):console.log(T.importerList))}),i.on("importerData",function(t){if("Normal"===T.systemStatus)if(e.cancel(T.requestImporterPromiseToSolve),0!==t.length)T.currentDataItem=t[0],T.stepOne=!1,T.stepTwo=!1,T.stepTwoB=!0,T.stepThree=!1,T.importerToDisplayContent=t;else if(0===t.length&&(T.importerToDisplayContent.forEach(function(e,t,o){i.emit("requestImporterDataItemData",{fieldName:e.fieldName,location:T.importerToDisplay.location})}),0===T.importerToDisplayContent.length)){for(var o=!1,a=0;a<T.alerts.stepOne.length;a++)"Received Empty Importer"===T.alerts.stepOne[a].msg&&(o=!0);o||T.alerts.stepOne.push({type:"warning",msg:"Received Empty Importer"})}}),i.on("importerDataItemData",function(e){"Normal"===T.systemStatus&&(0!==e.data.length?(T.importerDataItemToDisplay[e.name]||(T.importerDataItemToDisplay[e.name]=[]),T.importerDataItemToDisplay[e.name]=T.importerDataItemToDisplay[e.name].concat(e.data)):0===e.data.length&&(T.importerDataItemData=T.importerDataItemToDisplay[T.currentDataItem.fieldName],console.log(T.importerDataItemData)))});var I=[];i.on("importerCreationResponse",function(e){"Normal"===T.systemStatus&&(0!==e.data.length?I=I.concat(e.data):(console.log(T.stepThreeFormCollection),T.stepThreeFormCollection=n(I),T.importerCreationMeta={importerName:e.importerName,location:e.location,userName:e.userName,files:e.files},I=[],T.stepOne=!1,T.stepTwo=!1,T.stepTwoB=!1,T.stepThree=!0))}),l()}angular.module("Dave2.Importer").controller("ImporterUploadCtrl",e),e.$inject=["$timeout","$http","$scope","$modal","Upload","FormSettingParseService","ImporterSocket"]}();